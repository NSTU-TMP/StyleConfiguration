using System;using System.Collections.Generic;using System.IO;using System.Reactive;using Avalonia.Controls;using ReactiveUI;namespace StyleConfiguration.Config;public class MenuItemsParser {    private static bool IsLineCorrect(string[] splitLine) => splitLine.Length is 3 or 4;    public static List<MenuItem> Parse(string pathToFile, ReactiveCommand<string, Unit> command)    {        return Parse(File.ReadAllLines(pathToFile), command);    }    public static List<MenuItem> Parse(string[] lines, ReactiveCommand<string, Unit> command)    {        if (lines == null) throw new Exception("Null array");        int line_number = 0;        string? line = lines[line_number];        var splitLine = line.Split();                int counter = 0;        var rootTitles = new List<MenuItem>();        var currentTitles = rootTitles;        var previousMenuItem = new MenuItem();        while (lines.Length > line_number)        {            if (IsLineCorrect(splitLine))            {                var titleStep = Int32.Parse(splitLine[0]);                if (titleStep == counter) // остаемся тут же                 {                    currentTitles.Add(new MenuItem                    {                        Header = splitLine[1],                        IsEnabled = splitLine[2] != "1",                        IsVisible = splitLine[2] != "2",                        CommandParameter = splitLine[1],                        Command = command,                    });                    previousMenuItem =  currentTitles[^1];                }                else if (titleStep == counter + 1) // добавляем текущему ребенка                {                    counter++;                    currentTitles = new List<MenuItem>();                    currentTitles.Add(new MenuItem                    {                        Header = splitLine[1],                        IsEnabled = splitLine[2] != "1",                        IsVisible = splitLine[2] != "2",                        CommandParameter = splitLine[1],                        Command = command,                    });                    previousMenuItem.Items = currentTitles;                    previousMenuItem = currentTitles[^1];                }                else if (titleStep < counter && titleStep >= 0) // спустились на шаг(мб несколько) вниз                {                    counter = titleStep;                                        currentTitles = rootTitles;                    for (int i = 0; i < titleStep; i++)                    {                        if (currentTitles is null) throw new Exception("пока что говно");                        previousMenuItem = currentTitles[^1];                        currentTitles = currentTitles[^1].Items as List<MenuItem>;                    }                    if (currentTitles is null) throw new Exception("пока что говно");                                        currentTitles.Add(new MenuItem                    {                        Header = splitLine[1],                        IsEnabled = splitLine[2] != "1",                        IsVisible = splitLine[2] != "2",                        CommandParameter = splitLine[1],                        Command = command,                    });                }                else                {                    throw new Exception("пока что говно");;                }            }            line_number++;            if (lines.Length > line_number)            {                line = lines[line_number];                splitLine = line.Split();            }        }        return rootTitles;    }}